<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>系统管理</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="ion-padding">
    <ion-card>
      <ion-card-header>
        <ion-card-title>系统设置 (config.yaml)</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-label position="stacked">Server Port</ion-label>
            <ion-input type="number" [(ngModel)]="settings.server_port" disabled></ion-input>
          </ion-item>
          <!-- Add other settings if backend exposes them editable via API -->
          <!-- The backend UpdateSettings likely just updates DB overrides or config file? -->
          <!-- Checking handlers/system.go: UpdateSettings updates configs/config.yaml or DB? -->
          <!-- Usually it's limited. Let's just show basic info or what API returns. -->
          <ion-item>
            <ion-label>Current Mode</ion-label>
            <ion-note slot="end">{{ settings.server_mode }}</ion-note>
          </ion-item>
        </ion-list>
        <!-- Save button if editable -->
        <!-- <ion-button expand="block" (click)="saveSettings()">保存设置</ion-button> -->
      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-header>
        <ion-card-title>数据备份与恢复</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-button expand="block" color="secondary" (click)="backup()">
          <ion-icon slot="start" name="download-outline"></ion-icon>
          下载数据库备份
        </ion-button>

        <div style="margin-top: 16px;">
          <input type="file" #fileInput style="display: none" (change)="restore($event)" accept=".db,.sqlite">
          <ion-button expand="block" color="warning" (click)="fileInput.click()">
            <ion-icon slot="start" name="refresh-outline"></ion-icon>
            恢复数据库备份
          </ion-button>
          <p class="ion-text-center ion-text-small text-muted">恢复后系统将重启</p>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card *ngIf="agentVersion">
      <ion-card-header>
        <ion-card-title>版本信息</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label>Agent Version</ion-label>
          <ion-note slot="end">{{ agentVersion.version }}</ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Platform</ion-label>
          <ion-note slot="end">{{ agentVersion.platform }}</ion-note>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>