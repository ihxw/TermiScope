<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>

    <!-- Custom Toolbar Content -->
    <div class="terminal-toolbar-container">
      <!-- Host Selector -->
      <div class="host-selector-wrapper">
        <ion-icon name="server-outline" class="selector-icon"></ion-icon>
        <ion-select placeholder="选择主机" [value]="selectedHostId" (ionChange)="onHostChange($event)" interface="popover"
          mode="ios">
          <ion-select-option *ngFor="let h of hosts" [value]="h.id">{{ h.name }}</ion-select-option>
        </ion-select>
      </div>

      <!-- Connect Button - Conditionally Rendered -->
      <ion-button class="btn-connect" (click)="connectToHost()" *ngIf="!isConnected" fill="solid" color="primary">
        <ion-icon name="add" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button class="btn-connect" (click)="disconnect()" *ngIf="isConnected" fill="solid" color="danger">
        <ion-icon name="power" slot="icon-only"></ion-icon>
      </ion-button>

      <!-- Right Actions -->
      <div class="right-actions">
        <ion-button fill="clear" size="small" (click)="openCommands()" title="命令">
          <ion-icon slot="icon-only" name="flash-outline"></ion-icon>
        </ion-button>
        <ion-button fill="clear" size="small" (click)="openRecordings()" title="录像">
          <ion-icon slot="icon-only" name="videocam-outline"></ion-icon>
        </ion-button>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="terminal-page-content">
  <!-- Active Terminal -->
  <div *ngIf="hostId" class="terminal-wrapper">
    <div #terminalContainer class="terminal-container"></div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!hostId" class="empty-state">
    <div class="empty-illustration">
      <ion-icon name="file-tray-outline" class="empty-icon"></ion-icon>
      <ion-icon name="chatbubble-ellipses-outline" class="empty-bubble"></ion-icon>
    </div>
    <p class="empty-text">没有活动的终端</p>

    <ion-button color="primary" expand="block" class="btn-big-connect" (click)="connectToHost()"
      [disabled]="!selectedHostId">
      <ion-icon slot="start" name="add"></ion-icon>
      连接到 SSH 主机
    </ion-button>
  </div>
</ion-content>

<!-- Virtual Keyboard Footer (Only when connected) -->
<ion-footer *ngIf="hostId">
  <ion-toolbar class="virtual-keyboard">
    <ion-buttons slot="start"
      style="overflow-x: auto; width: 100%; display: flex; flex-wrap: nowrap; -webkit-overflow-scrolling: touch;">
      <ion-button (click)="sendKey('\x1b')">Esc</ion-button>
      <ion-button (click)="sendKey('\t')">Tab</ion-button>
      <ion-button (click)="sendKey('\x03')">Ctrl+C</ion-button>
      <ion-button (click)="sendKey('\x04')">Ctrl+D</ion-button>
      <ion-button (click)="sendKey('\x1b[A')">↑</ion-button>
      <ion-button (click)="sendKey('\x1b[B')">↓</ion-button>
      <ion-button (click)="sendKey('\x1b[D')">←</ion-button>
      <ion-button (click)="sendKey('\x1b[C')">→</ion-button>
      <ion-button (click)="sendKey('/')">/</ion-button>
      <ion-button (click)="sendKey('-')">-</ion-button>
      <ion-button (click)="sendKey('|')">|</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>